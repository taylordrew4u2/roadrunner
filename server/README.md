# Roadrunner Backend - Fly.io Deployment

This is a Node.js/Express backend API for the Roadrunner trip planning application, deployed on Fly.io.

## Project Structure

```
server/
├── index.ts           # Main Express application
├── package.json       # Dependencies
├── tsconfig.json      # TypeScript configuration
├── fly.toml           # Fly.io deployment configuration
├── Dockerfile         # Docker image configuration
└── dist/              # Compiled JavaScript (generated by build)
```

## API Endpoints

### Trips
- `POST /api/trips` - Create a new trip
- `GET /api/trips` - Get all trips for the authenticated user
- `GET /api/trips/:tripId` - Get a specific trip
- `PATCH /api/trips/:tripId` - Update a trip

### Members
- `GET /api/trips/:tripId/members` - Get all members of a trip
- `POST /api/trips/:tripId/members` - Add a member to a trip

### Events (Itinerary)
- `GET /api/trips/:tripId/events` - Get all events for a trip
- `POST /api/trips/:tripId/events` - Create an event
- `DELETE /api/trips/:tripId/events/:eventId` - Delete an event

### Tasks (To-Do)
- `GET /api/trips/:tripId/tasks` - Get all tasks for a trip
- `POST /api/trips/:tripId/tasks` - Create a task
- `PATCH /api/trips/:tripId/tasks/:taskId/check` - Toggle task completion
- `DELETE /api/trips/:tripId/tasks/:taskId` - Delete a task

### Notes
- `GET /api/trips/:tripId/notes` - Get trip notes
- `PUT /api/trips/:tripId/notes` - Update trip notes

### Invites
- `POST /api/trips/:tripId/invites` - Create an invite link
- `GET /api/invites/:token` - Get invite details
- `POST /api/invites/:token/join` - Join a trip via invite link

## Local Development

### Prerequisites
- Node.js 20+
- npm or yarn

### Setup

1. Install dependencies:
```bash
cd server
npm install
```

2. Start the development server:
```bash
npm run dev
```

The server will run on `http://localhost:3001` by default.

## Building

To build the TypeScript code:
```bash
npm run build
```

This compiles TypeScript to JavaScript in the `dist/` directory.

## Deployment to Fly.io

### Prerequisites
- Fly.io account
- Fly CLI installed (`brew install flyctl`)

### Deploy

1. Log in to Fly.io:
```bash
flyctl auth login
```

2. Create the app (first time only):
```bash
flyctl launch --name roadrunner-server
```

3. Deploy:
```bash
npm run deploy
# or
flyctl deploy
```

### Check Logs

```bash
flyctl logs
```

### Scale Up/Down

```bash
flyctl scale count 2
```

## Environment Variables

The following environment variables are supported:

- `PORT` - Port to run the server on (default: 3001)
- `NODE_ENV` - Node environment (development/production)

User identification uses the `X-User-ID` header sent by the frontend client. The server generates and returns a unique ID for anonymous users.

## Data Storage

Currently, the server uses in-memory storage. For production use, integrate a database like:
- PostgreSQL (recommended for Fly.io)
- MongoDB
- Firebase Firestore

## Authentication

The backend uses anonymous authentication via the frontend. Each user is identified by a unique UUID stored in localStorage on the client side and passed via the `X-User-ID` header.

## CORS

CORS is enabled for all origins. For production, restrict this:

```typescript
app.use(cors({
  origin: 'https://yourdomain.com'
}));
```

## Health Check

A health check endpoint is available at `GET /health` for monitoring and load balancers.
